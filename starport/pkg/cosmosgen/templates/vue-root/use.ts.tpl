// Generated by Ignite ignite.com/cli
import { OfflineDirectSigner } from '@cosmjs/proto-signing'
import { SigningStargateClient } from '@cosmjs/stargate'
import { {{ capitalCase .Repo }}, registry } from '{{ .User }}-{{ .Repo }}-ts-client'
import { toRefs, ToRefs, reactive, UnwrapNestedRefs } from 'vue'

type State = UnwrapNestedRefs<{{ capitalCase .Repo }}>

type Response = {
    {{ camelCaseLowerSta .Repo }}: ToRefs<{{ capitalCase .Repo }}>
    signIn: (offlineSigner: OfflineDirectSigner) => void
    signOut: () => void
    inject: (instance: {{ capitalCase .Repo }}) => void
}

let _{{ camelCaseLowerSta .Repo }}Global: State

export default function (): Response {
    let signIn = async (offlineSigner: OfflineDirectSigner) => {
        let [acc] = await offlineSigner.getAccounts()

        let stargateClient = await SigningStargateClient.connectWithSigner(
            _{{ camelCaseLowerSta .Repo }}Global.env.rpcURL,
            offlineSigner,
            { registry }
        )
        let addr = acc.address

        _{{ camelCaseLowerSta .Repo }}Global.signer.client = stargateClient
        _{{ camelCaseLowerSta .Repo }}Global.signer.addr = addr

        {{ $Repo := camelCaseLowerSta .Repo }}
        {{ range .Modules }}
        _{{ $Repo }}Global.{{ camelCaseLowerSta .Pkg.Name }}.withSigner(stargateClient, addr)
        {{ end }}
    }

    let signOut = () => {
        _{{ camelCaseLowerSta .Repo }}Global.signer.client = undefined
        _{{ camelCaseLowerSta .Repo }}Global.signer.addr = undefined

        {{ $Repo := camelCaseLowerSta .Repo }}
        {{ range .Modules }}
        _{{ $Repo }}Global.{{ camelCaseLowerSta .Pkg.Name }}.noSigner()
        {{ end }}
    }

    let inject = (instance: {{ capitalCase .Repo }}) => {
        _{{ camelCaseLowerSta .Repo }}Global = reactive<{{ capitalCase .Repo }}>(instance)
    }

    return {
        inject,
        {{ camelCaseLowerSta .Repo }}: toRefs(_{{ camelCaseLowerSta .Repo }}Global as {{ capitalCase .Repo }}),
        signIn,
        signOut
    }
}
